---
title: Deploy Pool² for Development
slug: guide/deployment
---

# Deploy Pool² for Development

## Install Docker

The Pool² implements its microservice architecture using [docker](https://www.docker.com/) that can easily setup on the 
most operating systems. Guides can be found at the [docker documentation](https://docs.docker.com/install/). You need to 
install the `docker-ce` package. Don't worry about stage and edge version, it works fine with both. The staging server 
uses [debian](https://www.debian.org/index.de.html) as operating system. If you want to deploy the Pool² as development 
system it makes sense to setup a virtual machine (VM) via [VirtualBox](https://www.virtualbox.org/) or 
[vmware](https://www.vmware.com/de.html). There are a lot of guides online, that can help you to setup a VM.<br />
___Notice:___ The scripts you need to setup the Pool² development system are written for `bash` on a linux system.

After setting up the VM and docker-ce, you can start the docker service using `sudo systemctl start docker.service`. Next 
your system user need access to docker.service. 

For Ubuntu:
```bash
	sudo groupadd docker
	sudo useradd username
	sudo usermod -aG docker username 
```
(Replace `username`)

## Using the Pool² scripts

For deployment of the Pool², you can use the [pool2-deployment-scripts](https://github.com/Viva-con-Agua/pool2-deployment-scripts). 
These scripts are hosted on [GitHub](https://github.com/). If you want to deploy for development, you need the `develop` 
branch.<br />
___Notice:___ The scripts create a folder in the parent directory of your execution path. If your user is not assigned to
the docker-group and you start the script with `sudo`, the new folder is only accessible by root. On staging, we have 
created a folder, named `Pool` and copied the repository into it. 

For Ubuntu:
```bash
	mkdir ~/directory-name
	cd ~/directory-name
	git clone -b develop https://github.com/Viva-con-Agua/pool2-deployment-scripts.git
```
Now, `directory-name` contains the `pool2-deployment-scripts` directory containing all important setup scripts. Especially, 
there you can find the `pool.sh` which works as control script. 

Controlling the application requires three commands:

1. You can start the pool in dev mode with `./pool.sh dev setup`
2. You can delete the pool with `./pool.sh clean setup`
3. You can completely delete the pool with `./pool.sh cleanfull setup`

___Notice:___ The docker service needs root access except the user is not in the docker-group<br />
___Attention!___ On `cleanfull setup` also the database docker container and the Pool² sub-network (`pool-network`) will
be deleted. All your data will be lost. 

After startup, the Pool² should be available at `http://localhost`.

The scripts also initiate a Pool² sub-network, called `pool-network`. Every started docker can be assigned to an IP address
in range of this network. You can find all IPs with `docker network inspect pool-network`.

## Read the Logs

In some cases, you need to read the logs. For this purpose, you can use the given scripts: `./pool.sh logs microservice_name`. So, if everything works, you have to register your first user on _Drops_. Activation of your account requires to use a link that has sent you by email. On a development system, a mockup email server is used, writing the email to the logs of _Drops_. Thus you can call the link from the logs by `./pool.sh logs drops`.

## Setup your own Microservice

Next to the microservices implementing functional requirements, there is also a number of microservices and docker 
container running, implementing non-functional requirements:
* [Nginx](https://www.nginx.com/) docker serving as a Reverse-Proxy to redirect incoming requests into the `pool-network`
* [nats](https://nats.io/) docker hosts a message broker, that is used by the microservices for event-based communication
* __Dispenser__ docker that handles templates, as described by the [UI-Fragment-Composition concept](concepts/ui/fragment/composition)

The [Nginx](https://www.nginx.com/) docker is also listening at `localhost:8080`. Thus, you can deploy your microservice 
at port `8080` and all docker container in range of `pool-network` will have access to it. Furthermore, the content 
generated by your microservice will be accessible at `http://localhost/sozmed`.   

## Setup more docker

In case you need a database or any additional stuff, it can be easily deployed as a docker container in our `pool-network`. 
Simply add the `--net` parameter appended to the `run` command. For example, if you want to deploy [mariadb](https://mariadb.org/): 
```bash
	docker run --name ms-mariadb --net pool-network -d maria
```

This will setup a [mariadb](https://mariadb.org/) with a `pool-network` IP. The subnet is defined in range of the IP-Space 
172.2.0.0/16. The `-d` parameter starts the docker as daemon in the background. You can read the logs using 
`docker logs ms-mariadb` and also can get `bash` access using `docker exec -it ms-mariadb bash`. 
Otherwise, it is also possible to setup your docker with a static IP or forward ports to the localhost. For example:

```bash
	docker run --net pool-network --ip 172.2.30.1 -p 4000:3306 -d maria

```
The database can now be accessed on the IP `172.2.30.1:3306` or on `localhost:4000`. The `-p` parameter links the 
localhosts port 4000 to the docker containers port 3306.


**Author:** [Dennis Kleber](https://cses.informatik.hu-berlin.de/members/dennis.kleber/), [Johann Sell](https://cses.informatik.hu-berlin.de/members/johann.sell/) -- 
**Created:** 2018-06-05 --
**Updated:** 2018-06-11